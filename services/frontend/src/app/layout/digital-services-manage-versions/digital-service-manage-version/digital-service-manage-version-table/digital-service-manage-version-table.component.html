<p-table
    [value]="versionData"
    [scrollable]="true"
    [sortOrder]="1"
    [rows]="10"
    [paginator]="true"
    [scrollable]="true"
    scrollHeight="calc(100vh - 320px)"
    styleClass="my-3 manage-version-table"
    [rowsPerPageOptions]="[5, 10, 20, 50, 100]"
>
    <ng-template pTemplate="caption">
        <div class="table-header">
            <div class="table-head">
                {{ "digital-services.version.versions" | translate }}
            </div>
            <div>
                <p-button
                    (onClick)="compareVersions()"
                    styleClass="uppercase"
                    id="compare-versions"
                    icon="pi pi-chart-bar"
                    [label]="'digital-services.version.compare-versions' | translate"
                    [ariaLabel]="'digital-services.version.compare-versions' | translate"
                    [disabled]="selectedVersions.length < 2"
                ></p-button>
                <i
                    [pTooltip]="
                        'digital-services.version.compare-version-tooltip' | translate
                    "
                    tooltipPosition="bottom"
                    class="pi pi-exclamation-circle font-bold ml-2 font-bold text-2xl mb-2 mr-4 color-tertiary"
                ></i>
            </div>
        </div>
    </ng-template>
    <ng-template pTemplate="header">
        <caption class="visually-hidden">
            {{
                "digital-services.version.versions" | translate
            }}
        </caption>
        <tr>
            <th scope="col" id="versionType" pSortableColumn="versionType">
                {{ "digital-services.version.status" | translate }}
                <p-sortIcon field="versionType"></p-sortIcon>
            </th>

            <th scope="col" id="versionName" pSortableColumn="versionName">
                {{ "digital-services.version.version-name" | translate }}
                <p-sortIcon field="versionName"></p-sortIcon>
            </th>
            <th scope="col" id="lastName">
                {{ "digital-services.version.actions" | translate }}
            </th>
            <th scope="col" id="select">
                {{ "digital-services.version.select" | translate }}
            </th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-version let-rowIndex="rowIndex">
        <tr>
            <td>
                <app-version-type-tag
                    [versionType]="version.versionType"
                ></app-version-type-tag>
            </td>
            <td>
                <p-button
                    class="p-0 m-0 text-left"
                    (onClick)="redirectToVersionDetails(version.digitalServiceVersionUid)"
                    [label]="version.versionName"
                    styleClass="p-button-link"
                ></p-button>
            </td>
            <td>
                <p-button
                    icon="pi pi-clone"
                    [text]="true"
                    [plain]="true"
                    [rounded]="true"
                    (onClick)="
                        duplicateDigitalServiceVersion(version.digitalServiceVersionUid)
                    "
                    [pTooltip]="'digital-services.version.duplicate-version' | translate"
                    tooltipPosition="bottom"
                    [ariaLabel]="'digital-services.version.duplicate-version' | translate"
                ></p-button>
                @if (version.versionType === "draft") {
                    <p-button
                        icon="pi pi pi-star"
                        [text]="true"
                        [plain]="true"
                        [rounded]="true"
                        (onClick)="isPromoteVersionDialogVisible = true"
                        [pTooltip]="
                            'digital-services.version.promote-version' | translate
                        "
                        tooltipPosition="bottom"
                        [ariaLabel]="
                            'digital-services.version.aria-promote-version' | translate
                        "
                    ></p-button>
                }
                @if (version.versionType !== "active") {
                    <p-confirmPopup [style]="{ width: '450px' }" />
                    <p-button
                        icon="pi pi pi-trash"
                        id="manage-version-delete"
                        [text]="true"
                        [plain]="true"
                        [rounded]="true"
                        [pTooltip]="'digital-services.version.delete-version' | translate"
                        tooltipPosition="bottom"
                        (onClick)="confirmDelete($event, version)"
                        [ariaLabel]="
                            'digital-services.version.aria-delete-version' | translate
                        "
                    ></p-button>
                }
            </td>
            <td>
                <p-checkbox
                    [binary]="true"
                    [(ngModel)]="version.selected"
                    (onChange)="onVersionSelect(version)"
                    [disabled]="
                        (!version.selected && selectedVersions.length >= 2) ||
                        !version.lastCalculationDate
                    "
                    [ariaLabel]="
                        'digital-services.version.select-version'
                            | translate: { versionTableName: version.versionName }
                    "
                ></p-checkbox>
            </td>
        </tr>
    </ng-template>
</p-table>
@if (isPromoteVersionDialogVisible) {
    <app-promote-version-dialog
        [dsvId]="dsVersionUid"
        [displayPopup]="isPromoteVersionDialogVisible"
        (outClose)="isPromoteVersionDialogVisible = false"
        (promotedEvent)="getVersions()"
    ></app-promote-version-dialog>
}
